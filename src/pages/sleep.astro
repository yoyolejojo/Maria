---
import BaseHead from '../components/BaseHead.astro';

import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';

// Liste de phrases al√©atoires
const phrases = [
    "Faut l'√©duquer celui-l√†",
    "Il croit qu'il va pouvoir te rendre ton sommeil en t'offrant des fleurs ?",
    "Insupportable, un homme quoi...",
    "S'il relance la conversation il va voir",
    "Y'a des claques qui se perdent Maria...",
    "Allez hop, au dodo !",
    "Minimum il te laisse dormir 8 heures",
    "A la poubelle, c'est leur place",
];

// Liste d'images al√©atoires
const images = [
    "/dodo/bouton.jpg",
    "/dodo/1.jpg",
    "/dodo/2.jpg",
    "/dodo/3.jpg",
    "/dodo/4.jpg",
    "/dodo/5.jpg",
    "/dodo/6.jpg",
    "/dodo/7.jpg",
    "/dodo/8.jpg",
    // Ajoutez autant d'images que vous voulez
];


---

<!DOCTYPE html>
<html lang="fr">
    <!-- <span id="phrase-data" data-phrase={randomPhrase} style="display: none;"></span> -->
<head>
    
    <BaseHead title="Il est l'heure !" description="Page pour envoyer une notification" />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
</head>
<body>
    <Header />
    <main>
        <div class="sleep-container">
            <h1>üí§ Dis lui d'aller se coucher</h1>
            
                
            <p class="random-phrase" id="random-phrase"></p>
            <img id="random-image" src="" alt="Image du sommeil" class="sleep-image" />
            <button id="sleep-btn"> Va dormir !</button>
            
            <div id="message"></div>
        </div>
        <div id="phrase-data" style="display: none;"></div>
    </main>

    <Footer />

    <style>
        .sleep-container * {
            font-family: inherit;
        }

        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: inherit
        }

        .sleep-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            text-align: center;
            width: 100%;
        }

        h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            animation: bounce 2s infinite;
            color: #667eea;
            font-family: inherit
        }

        .random-phrase {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            color: #764ba2;
            font-weight: 500;
            
        }

        #sleep-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 2rem;
            padding: 1.5rem 3rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
            margin-top: 6%;
            margin-bottom: -15%;
        }

        #sleep-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        #sleep-btn:active {
            transform: scale(0.95);
        }

        #sleep-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        #message {
            margin-top: 2rem;
            font-size: 1.2rem;
            padding: 1rem;
            border-radius: 10px;
            min-height: 50px;
        }

        #message.success {
            background: #d4edda;
            color: #155724;
        }

        #message.error {
            background: #f8d7da;
            color: #721c24;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .random-phrase {
                font-size: 1.2rem;
            }
            
            #sleep-btn {
                font-size: 1.5rem;
                padding: 1rem 2rem;
            }
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            top: -20px;
            z-index: 99999 !important;
            animation: confetti-fall linear forwards;
            opacity: 1;
            border-radius: 50%;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        .sleep-image {
            max-width: 400px;
            width: 100%;
            height: auto;
            border-radius: 15px;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .sleep-image {
                max-width: 300px;
            }
        }

    </style>

    <!-- Script 1 : Pour la phrase et l'image al√©atoires -->
    <script define:vars={{ phrases, images }}>
        // Choisir phrase et image al√©atoires
        const randomPhrase = phrases[Math.floor(Math.random() * phrases.length)];
        const randomImage = images[Math.floor(Math.random() * images.length)];
        
        // Afficher la phrase et l'image
        document.getElementById('random-phrase').textContent = randomPhrase;
        document.getElementById('random-image').src = randomImage;
        document.getElementById('phrase-data').textContent = randomPhrase;
    </script>
    
    <script>
        function createConfetti() {
        confetti({
            particleCount: 100,
            spread: 360,
            startVelocity: 30,
            gravity: 0.5,
            scalar: 0.8,
            drift: 0,
            ticks: 300,
            origin: { x: 0.5, y: 0.5 },
            colors: ['#FFD700', '#FFC0CB', '#FF69B4', '#DDA0DD', '#87CEEB', '#98FB98'],
            shapes: ['star'],
            zIndex: 999999
        });
    }

        const botToken = import.meta.env.PUBLIC_TELEGRAM_BOT_TOKEN;
    const chatId = import.meta.env.PUBLIC_TELEGRAM_CHAT_ID;
    const btn = document.getElementById('sleep-btn');
    const messageDiv = document.getElementById('message');

    btn.addEventListener('click', async () => {
        btn.disabled = true;
        btn.textContent = 'Envoi en cours...';

        const randomPhrase = document.getElementById('phrase-data').textContent;
        const message = `üõèÔ∏è Maria dit qu'il est temps d'aller dormir ! üí§\n\n"${randomPhrase}"\n\nHeure : ${new Date().toLocaleString('fr-FR')}`;

        try {
            const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json; charset=utf-8',
                },
                body: JSON.stringify({
                    chat_id: chatId,
                    text: message,
                }),
            });

            const data = await response.json();

            if (data.ok) {
                createConfetti();
                messageDiv.textContent = '‚úÖ Message envoy√© ! Bonne nuit üò¥';
                messageDiv.className = 'success';
            } else {
                throw new Error('Erreur Telegram');
            }
        } catch (error) {
            messageDiv.textContent = '‚ùå Erreur lors de l\'envoi...';
            messageDiv.className = 'error';
            console.error(error);
        } finally {
            btn.disabled = false;
            btn.textContent = 'üõèÔ∏è Va dormir !';
            
            setTimeout(() => {
                messageDiv.textContent = '';
                messageDiv.className = '';
            }, 3000);
        }
    });
    </script>
</body>
</html>